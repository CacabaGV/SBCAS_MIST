<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MIST Sa√∫de - An√°lise de Dados</title>
  <style>
    /* Reset e estilos globais */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fdfdfd;
      min-height: 100vh;
      color: #333;
    }

    /* Scrollbar customizada */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 10px;
    }


    /* Container principal */
    .site-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    header {
      background: white;
      border-radius: 15px;
      padding: 20px 30px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo img {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #667eea;
    }

    .logo p {
      font-size: 1.5rem;
      font-weight: 600;
      color: #000;
      margin: 0;
    }

    .botao a {
      background: #667eea;
      color: white;
      text-decoration: none;
      padding: 12px 30px;
      border-radius: 25px;
      font-weight: 500;
      transition: transform 0.3s, box-shadow 0.3s;
      display: inline-block;
    }

    .botao a:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    /* Container do conte√∫do */
    .container {
      display: grid;
      grid-template-columns: 1fr 3fr 1fr; /* 3 colunas para melhor controle */
      gap: 25px;
      margin-top: 20px;
    }

    /* Layout espec√≠fico para cada card */
    /* Linha 1: Selecionar Arquivo - centralizado e menor */
    #card1 {
      grid-column: 1 / -1; /* Apenas coluna central */
      grid-row: 1;
    }

    /* Linha 2: Descri√ß√£o do Banco */
    #card2 {
      grid-column: 1 / -1; /* Ocupa toda a largura */
      grid-row: 2;
      max-height: 600px;
    }

    /* Linha 3: Colunas com NaNs */
    #card3 {
      grid-column: 1 / -1; /* Ocupa toda a largura */
      grid-row: 3;
    }

    /* Linha 4: Sele√ß√£o Quadrantes (esquerda) - menor */
    #card4 {
      grid-column: 1 / 2; /* Primeira coluna */
      grid-row: 4;
    }

    /* Linha 4: Informa√ß√£o Quadrantes (direita) - mais √™nfase */
    #card5 {
      grid-column: 2 / -1; /* Segunda e terceira colunas - maior */
      grid-row: 4;
      min-height: 400px;
    }

    /* Linha 5: Imputa√ß√£o */
    #card6 {
      grid-column: 1 / -1; /* Ocupa toda a largura */
      grid-row: 5;
    }

    /* Layout horizontal no Card 6 */
    #card6 .checks-container {
      display: flex;
      gap: 20px;              /* espa√ßo entre as duas divs */
      align-items: flex-start;
    }

    #card6 .primeiro_check,
    #card6 .segundo_check,
    #card6 .escolher_modelo {
      flex: 1;                /* ambas ocupam o mesmo tamanho */
    }


    /* Estilos espec√≠ficos para descri√ß√£o do banco */
    #card2 .description-content {
      max-height: 500px;
      overflow-y: auto;
      overflow-x: auto;
    }

    #card2 .column-info {
      background: #f8f9ff;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    #card2 .column-info h3 {
      color: #667eea;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    #card2 .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    #card2 .stat-item {
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    #card2 .stat-label {
      font-weight: 600;
      color: #666;
      display: block;
      font-size: 0.85rem;
    }

    #card2 .stat-value {
      color: #333;
      font-size: 1rem;
      margin-top: 4px;
    }

    /* Estilos para colunas com NaNs - layout horizontal */
    #card3 .nans-container {
      overflow-x: auto;
    }

    #card3 .nans-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    #card3 .nan-item {
      background: #f8f9ff;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      border: 2px solid #e0e0e0;
      transition: all 0.3s;
    }

    #card3 .nan-item:hover {
      border-color: #667eea;
      transform: translateY(-2px);
    }

    #card3 .nan-column-name {
      font-weight: 600;
      color: #667eea;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    #card3 .nan-count {
      font-size: 1rem;
      font-weight: bold;
      color: #333;
      margin: 5px 0;
    }

    #card3 .nan-percentage {
      color: #666;
      font-size: 0.7rem;
    }

    /* Estilos para informa√ß√£o dos quadrantes */
    #card5 .quadrant-content {
      max-height: 500px;
      overflow-y: auto;
    }

    #card5 img {
      max-width: 75%;
      height: auto;
      border-radius: 8px;
      margin: 15px 0;
    }

    #card5 .quadrant-section {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f0f0f0;
    }

    #card5 .quadrant-section:last-child {
      border-bottom: none;
    }

    /* Cards */
    .card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      display: flex;
      flex-direction: column;
      height: fit-content;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(0,0,0,0.15);
    }

    .card h2 {
      color: #667eea;
      font-size: 1.5rem;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    /* Formul√°rios */
    .form-upload {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    input[type="file"] {
      padding: 10px;
      border: 2px dashed #667eea;
      border-radius: 10px;
      background: #f8f9ff;
      cursor: pointer;
    }

    input[type="text"], select {
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
      width: 100%;
    }

    input[type="text"]:focus, select:focus {
      outline: none;
      border-color: #667eea;
    }

    /* Estilos para checkboxes */
    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
      margin: 15px 0;
      padding: 15px;
      background: #f8f9ff;
      border-radius: 8px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .checkbox-item:hover {
      background: white;
    }

    .checkbox-item input[type="checkbox"] {
      cursor: pointer;
      width: 18px;
      height: 18px;
      accent-color: #667eea;
    }

    .checkbox-item label {
      cursor: pointer;
      margin: 0;
      font-size: 0.95rem;
      flex: 1;
    }

    .upload-area {
      border: 2px dashed #cbd5e1;
      border-radius: 12px;
      padding: 50px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #fbfdff;
    }

    .upload-area:hover {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .upload-area.dragover {
      background: #e8ecff;
    }

    .upload-content {
      pointer-events: none;
    }

    .upload-icon {
      font-size: 40px;
      color: #94a3b8;
      margin-bottom: 10px;
    }

    .upload-content p {
      color: #555;
      font-size: 1rem;
    }

    .file-name {
      display: inline-block;
      margin-top: 15px;
      padding: 6px 14px;
      background: #e0edff;
      color: #1d4ed8;
      border-radius: 999px;
      font-size: 0.9rem;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    /* Tabelas */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }

    th {
      background: #667eea;
      color: white;
      padding: 12px;
      text-align: left;
    }

    td {
      padding: 10px 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background: #f8f9ff;
    }

    /* Imagens nos cards */
    .card img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid #e0e0e0;
    }

    /* Mensagens de alerta customizadas */
    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      color: #333;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      border-left: 4px solid #667eea;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Loading spinner */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsividade */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        text-align: center;
      }

      .logo {
        flex-direction: column;
      }

      .container {
        grid-template-columns: 1fr;
      }

      /* Todos os cards ocupam toda a largura em mobile */
      #card1, #card2, #card3, #card4, #card5, #card6 {
        grid-column: 1 / -1;
      }

      button {
        width: 100%;
      }

      table {
        font-size: 0.9rem;
      }

      td, th {
        padding: 8px;
      }

      #card2 .stats-grid {
        grid-template-columns: 1fr;
      }

      #card3 .nans-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
    }

    @media (max-width: 480px) {
      .site-content {
        padding: 10px;
      }

      .card {
        padding: 15px;
      }

      .card h2 {
        font-size: 1.2rem;
      }

      .logo p {
        font-size: 1.2rem;
      }

      .logo img {
        width: 50px;
        height: 50px;
      }

      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
    }
  </style>
</head>
<body>
  <div class="site-content" id="siteContent">
    <header>
      <div class="logo">
        <img style="width: 90px; height: 90px;" src="imgs/logo.png" alt="Logo MIST Sa√∫de">
        <p class="inter">MIST Sa√∫de</p>
      </div>
      <div class="botao">
        <a href="index.html">Home Page</a>
      </div>
    </header>

    <div class="container">
      <!-- Card 1 - Upload -->
      <div class="card" id="card1">
        <h2>üìÅ Selecione Arquivo</h2>
        <div class="form-upload" id="form_describe">

        <div class="upload-area" id="uploadArea">
          <input type="file" id="input_file" accept=".csv,.xlsx,.xls,.parquet" hidden>

          <div class="upload-content">
            <div class="upload-icon">‚òÅÔ∏è</div>
            <p>Clique ou arraste seu arquivo aqui</p>
            <span id="fileName" class="file-name"></span>
          </div>
        </div>

        <button id="btn_selecao_dados" type="button">
          Enviar Arquivo
        </button>

      </div>
      </div>

      <!-- Card 2 - Descri√ß√£o -->
      <div class="card" id="card2">
        <h2>üìä Descri√ß√£o do Banco</h2>
        <p class="placeholder">Aguardando arquivo...</p>
      </div>

      <!-- Card 3 - NaNs -->
      <div class="card" id="card3">
        <h2>üîç Colunas com NaNs</h2>
        <p class="placeholder">Aguardando arquivo...</p>
      </div>

      <!-- Card 4 - Features para Quadrantes -->
      <div class="card" id="card4">
        <h2>üìê Sele√ß√£o para Quadrantes</h2>
        <p>Selecione as features:</p>
        <div id="checkbox_quadrantes" class="checkbox-group">
          <p class="placeholder" style="grid-column: 1/-1;">Enviando arquivo para carregar features...</p>
        </div>
        <button id="btn_selecao_quadrantes" type="button">Gerar Quadrantes</button>
      </div>

      <!-- Card 5 - Informa√ß√£o Quadrantes -->
      <div class="card" id="card5">
        <h2>üìà Informa√ß√£o dos Quadrantes</h2>
        <p class="placeholder">Aguardando an√°lise...</p>
      </div>

      <!-- Card 6 - Imputa√ß√£o -->
      <div class="card" id="card6">
        <h2>üîÑ Imputa√ß√£o de Dados</h2>
        <div class="form-upload">
          
          <div class="checks-container">
            <div class="primeiro_check">
              <p style="margin-top: 15px;">Features para imputar:</p>
              <div id="checkbox_imputar" class="checkbox-group">
                <p class="placeholder" style="grid-column: 1/-1;">Enviando arquivo para carregar features...</p>
              </div>
            </div>
            <div class="segundo_check">
              <p style="margin-top: 15px;">Features para ignorar:</p>
              <div id="checkbox_ignorar" class="checkbox-group">
                <p class="placeholder" style="grid-column: 1/-1;">Enviando arquivo para carregar features...</p>
              </div>
            </div>

            <div class="escolher_modelo">

            <b>M√©todo de Imputa√ß√£o</b>
            <select id="meuSelect">
              <option value="tabpfn">TABPFN </option>
              <option value="m√©dia">M√©dia </option>
              <option value="mice">MICE</option>
              <option value="knn">KNN</option>
              <option value="missforest">MissForest</option>
            </select>
            <p style="font-size: 80%;">Features selecionadas como 'Alvo' ter√£o seus NaNs substitu√≠dos pelo valor do m√©todo escolhido. Features 'Exclu√≠das' ser√£o ignoradas.</p>
            <br><br><br>

            <button id="btn_selecao_modelo" type="button">Aplicar Imputa√ß√£o e Baixar CSV</button>
            </div>

          </div>

          

        </div>
      </div>
    </div>
  </div>

  <script>
    const uploadArea = document.getElementById("uploadArea");
    const fileInput = document.getElementById("input_file");
    const fileName = document.getElementById("fileName");

    // Clique abre seletor
    uploadArea.addEventListener("click", () => {
      fileInput.click();
    });

    // Quando seleciona pelo input
    fileInput.addEventListener("change", () => {
      if (fileInput.files.length > 0) {
        fileName.textContent = fileInput.files[0].name;
      }
    });

    // Drag over
    uploadArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      uploadArea.classList.add("dragover");
    });

    // Drag leave
    uploadArea.addEventListener("dragleave", () => {
      uploadArea.classList.remove("dragover");
    });

    // Drop
    uploadArea.addEventListener("drop", (e) => {
      e.preventDefault();
      uploadArea.classList.remove("dragover");

      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files; // mant√©m compatibilidade com sua l√≥gica
        fileName.textContent = files[0].name;
      }
    });

    let uploadedFile = null;
    let allFeatures = []; // Armazenar todas as features

    // Fun√ß√£o para mostrar alertas customizados
    function showAlert(message, type = 'info') {
      const alert = document.createElement('div');
      alert.className = 'alert';
      alert.textContent = message;
      document.body.appendChild(alert);
      
      setTimeout(() => {
        alert.remove();
      }, 3000);
    }

    // Fun√ß√£o para mostrar loading em bot√µes
    function setLoading(button, isLoading) {
      if (isLoading) {
        button.disabled = true;
        button.innerHTML = 'Processando <span class="loading"></span>';
      } else {
        button.disabled = false;
        button.innerHTML = button.getAttribute('data-original-text');
      }
    }

    // Fun√ß√£o para gerar checkboxes
    function generateCheckboxes(containerId, features, defaultChecked = []) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      
      features.forEach(feature => {
        const isChecked = defaultChecked.includes(feature);
        const checkboxDiv = document.createElement('div');
        checkboxDiv.className = 'checkbox-item';
        
        checkboxDiv.innerHTML = `
          <input type="checkbox" id="check_${containerId}_${feature}" value="${feature}" ${isChecked ? 'checked' : ''}>
          <label for="check_${containerId}_${feature}">${feature}</label>
        `;
        
        container.appendChild(checkboxDiv);
      });
    }

    // Fun√ß√£o para obter features selecionadas
    function getSelectedCheckboxes(containerId) {
      const checkboxes = document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`);
      return Array.from(checkboxes).map(cb => cb.value);
    }

    // Salvar texto original dos bot√µes
    document.querySelectorAll('button').forEach(btn => {
      btn.setAttribute('data-original-text', btn.innerHTML);
    });

    // Card 1 - Upload e Describe
    document.getElementById('btn_selecao_dados').addEventListener('click', async function () {
      const fileInput = document.getElementById('input_file');
      const file = fileInput.files[0];
      const button = this;

      if (!file) {
        showAlert('Por favor, selecione um arquivo!', 'error');
        return;
      }

      setLoading(button, true);
      uploadedFile = file;
      const formData = new FormData();
      formData.append('file', file);

      try {
        const response = await fetch('http://localhost:8000/describe', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) throw new Error('Erro ao chamar /describe: ' + response.status);

        const data = await response.json();

        // Atualizar Card 2 com layout melhorado
        let html = `
          <div class="description-content">
            <div style="background: #667eea; color: white; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
              <h3 style="margin: 0; color: white;">üìä Informa√ß√µes Gerais</h3>
              <p style="margin: 10px 0 0 0; font-size: 1.1rem;">${data.shape.rows} linhas √ó ${data.shape.cols} colunas</p>
            </div>
        `;
        
        for (const col in data.describe) {
          html += `
            <div class="column-info">
              <h3>üìå ${col}</h3>
              <div class="stats-grid">
          `;
          
          for (const stat in data.describe[col]) {
            const value = data.describe[col][stat];
            const displayValue = typeof value === 'number' ? value.toFixed(4) : value;
            html += `
              <div class="stat-item">
                <span class="stat-label">${stat}</span>
                <div class="stat-value">${displayValue}</div>
              </div>
            `;
          }
          
          html += `
              </div>
            </div>
          `;
        }
        html += '</div>';
        document.getElementById('card2').innerHTML = `<h2>üìä Descri√ß√£o do Banco</h2>` + html;

        // Atualizar Card 3
        const formData2 = new FormData();
        formData2.append('file', file);

        const response2 = await fetch('http://localhost:8000/colunas_nans', {
          method: 'POST',
          body: formData2
        });

        if (!response2.ok) throw new Error('Erro ao chamar /colunas_nans: ' + response2.status);

        const data2 = await response2.json();

        let html2 = `
          <div class="nans-container">
            <p style="margin-bottom: 15px;"><strong>Total de colunas com valores ausentes: ${Object.keys(data2).length}</strong></p>
            <div class="nans-grid">
        `;
        
        const totalRows = data.shape.rows;
        for (const col in data2) {
          const nanCount = data2[col];
          const percentage = ((nanCount / totalRows) * 100).toFixed(2);
          html2 += `
            <div class="nan-item">
              <div class="nan-column-name">${col}</div>
              <div class="nan-count">${nanCount}</div>
              <div class="nan-percentage">${percentage}% ausentes</div>
            </div>
          `;
        }
        html2 += '</div></div>';
        document.getElementById('card3').innerHTML = `<h2>üîç Colunas com NaNs</h2>` + html2;

        // Atualizar Card 4 e Card 6 com checkboxes
        allFeatures = Object.keys(data.describe);
        generateCheckboxes('checkbox_quadrantes', allFeatures);
        generateCheckboxes('checkbox_imputar', allFeatures);
        generateCheckboxes('checkbox_ignorar', allFeatures);
        
        showAlert('Arquivo processado com sucesso!', 'success');

      } catch (err) {
        console.error(err);
        showAlert('Erro ao processar arquivo: ' + err.message, 'error');
      } finally {
        setLoading(button, false);
      }
    });

    // Card 4 - Quadrantes
    document.getElementById('btn_selecao_quadrantes').addEventListener('click', async function () {
      const file = uploadedFile;
      const features = getSelectedCheckboxes('checkbox_quadrantes');
      const button = this;

      if (!file) { 
        showAlert('Primeiro envie um arquivo no card 1!', 'error'); 
        return; 
      }
      
      if (features.length === 0) { 
        showAlert('Selecione ao menos uma feature!', 'error'); 
        return; 
      }

      setLoading(button, true);
      const params = new URLSearchParams();
      features.forEach(f => params.append('lista_features', f));

      const formData = new FormData();
      formData.append('file', file);

      try {
        const response3 = await fetch(`http://localhost:8000/info_quadrantes?${params.toString()}`, {
          method: 'POST',
          body: formData
        });

        if (!response3.ok) throw new Error('Erro ao chamar /info_quadrantes: ' + response3.status);

        const data3 = await response3.json();

        let html3 = '<div class="quadrant-content">';
        for (const item of data3) {
          html3 += `<div class="quadrant-section">`;
          html3 += `<h3 style="color: #667eea; font-size: 1.3rem; margin-bottom: 15px;">üìä ${item.feature}</h3>`;
          html3 += `<img src="data:image/png;base64,${item.imagem_base64}" alt="Gr√°fico ${item.feature}">`;
          
          if (item.erro_medio && Object.keys(item.erro_medio).length > 0) {
            html3 += `<p style="font-weight: 600; margin-top: 20px; margin-bottom: 10px;">Erro M√©dio por M√©todo:</p>`;
            html3 += `<div style="overflow-x: auto;"><table>`;

            const metodos = Object.keys(item.erro_medio);
            const quadrantes = metodos.length > 0 ? Object.keys(item.erro_medio[metodos[0]]) : [];

            html3 += `<tr><th>Quadrante</th>`;
            metodos.forEach(m => { html3 += `<th>${m}</th>`; });
            html3 += `</tr>`;

            for (const quadrante of quadrantes) {
              html3 += `<tr><td><strong>${quadrante}</strong></td>`;
              for (const metodo of metodos) {
                const val = item.erro_medio[metodo][quadrante];
                html3 += `<td>${(val !== null && val !== undefined) ? Number(val).toFixed(4) : '-'}</td>`;
              }
              html3 += `</tr>`;
            }
            html3 += `</table></div>`;
          }
          html3 += `</div>`;
        }
        html3 += '</div>';

        document.getElementById('card5').innerHTML = `<h2>üìà Informa√ß√£o dos Quadrantes</h2>` + html3;
        showAlert('Quadrantes gerados com sucesso!', 'success');

      } catch (err) {
        console.error(err);
        showAlert('Erro ao processar quadrantes: ' + err.message, 'error');
      } finally {
        setLoading(button, false);
      }
    });

    // Card 6 - Imputa√ß√£o
    document.getElementById('btn_selecao_modelo').addEventListener('click', async function () {
      const file = uploadedFile;
      const featuresImputarList = getSelectedCheckboxes('checkbox_imputar');
      const featuresIgnorarList = getSelectedCheckboxes('checkbox_ignorar');
      const metodo = document.getElementById('meuSelect').value;
      const button = this;

      if (!file) { 
        showAlert('Primeiro envie um arquivo no card 1!', 'error'); 
        return; 
      }

      if (featuresImputarList.length === 0) {
        showAlert('Selecione ao menos uma feature para imputar!', 'error');
        return;
      }

      setLoading(button, true);
      const formData3 = new FormData();
      formData3.append('arquivo', file);
      formData3.append('metodo', metodo);
      formData3.append('features_a_imputar', featuresImputarList.join(','));
      
      if (featuresIgnorarList.length > 0) {
        formData3.append('ignorar', featuresIgnorarList.join(','));
      }

      try {
        const response_imputacao = await fetch('http://localhost:8000/imputar', {
          method: 'POST',
          body: formData3
        });

        if (!response_imputacao.ok) throw new Error('Erro ao chamar /imputar: ' + response_imputacao.status);

        const blob = await response_imputacao.blob();
        const url = window.URL.createObjectURL(blob);

        const extensao = file.name.split('.').pop();
        const linkDownload = document.createElement('a');
        linkDownload.href = url;
        linkDownload.download = `imputado_resultado.${extensao}`;
        document.body.appendChild(linkDownload);
        linkDownload.click();
        linkDownload.remove();
        window.URL.revokeObjectURL(url);

        showAlert('Arquivo imputado baixado com sucesso!', 'success');

      } catch (err) {
        console.error(err);
        showAlert('Erro ao imputar dados: ' + err.message, 'error');
      } finally {
        setLoading(button, false);
      }
    });

    // Placeholder styling
    const style = document.createElement('style');
    style.textContent = `
      .placeholder {
        color: #999;
        font-style: italic;
        padding: 20px;
        text-align: center;
        background: #f8f9ff;
        border-radius: 8px;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>